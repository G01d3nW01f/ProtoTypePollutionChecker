<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>JavaScript è§£æãƒ„ãƒ¼ãƒ«</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    textarea { width: 100%; height: 200px; font-family: monospace; }
    .section { margin-top: 2em; }
    pre { background: #f8f8f8; padding: 1em; overflow-x: auto; }
    h2 { border-bottom: 1px solid #ccc; }
    input[type="file"] { margin-top: 1em; }
    button { margin-top: 1em; }
  </style>
</head>
<body>
  <h1>JavaScript è§£æãƒ„ãƒ¼ãƒ«ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰</h1>

  <p>JSã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã‹ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚</p>
  <textarea id="jsInput" placeholder="// ã“ã“ã«ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘"></textarea>
  <br>
  <input type="file" id="fileInput" accept=".js">
  <button onclick="analyze()">è§£æ</button>

  <div class="section">
    <h2>è§£æçµæœ</h2>
    <pre id="output"></pre>
  </div>

  <script>
    const patterns = {
      functions: /function\s+([a-zA-Z0-9_$]+)\s*\(|([a-zA-Z0-9_$]+)\s*=\s*\(.*?\)\s*=>/g,
      evals: /\b(eval|Function|setTimeout|setInterval)\s*\(/g,
      dom: /document\.(getElementById|getElementsByClassName|querySelector|write|createElement)/g,
      network: /\b(fetch|XMLHttpRequest|axios|navigator\.sendBeacon)\b/g,
      globals: /^[ \t]*([a-zA-Z0-9_$]+)\s*=\s*/gm,
    };

    document.getElementById('fileInput').addEventListener('change', function() {
      const file = this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        document.getElementById('jsInput').value = e.target.result;
      };
      reader.readAsText(file);
    });

    function analyze() {
      const code = document.getElementById('jsInput').value;
      const result = {};

      result.functions = [...code.matchAll(patterns.functions)].map(m => m[1] || m[2]);
      result.evals = [...code.matchAll(patterns.evals)].map(m => m[1]);
      result.dom = [...code.matchAll(patterns.dom)].map(m => `document.${m[1]}`);
      result.network = [...code.matchAll(patterns.network)].map(m => m[1]);
      result.globals = [...code.matchAll(patterns.globals)].map(m => m[1]);

      const out = [
        "ğŸ”¹ é–¢æ•°å®šç¾©:",
        ...result.functions.map(f => ` - ${f}`),
        "\nğŸ”¹ eval, setTimeout, Function ä½¿ç”¨:",
        ...result.evals.map(e => ` - ${e}`),
        "\nğŸ”¹ DOMã‚¢ã‚¯ã‚»ã‚¹:",
        ...result.dom.map(d => ` - ${d}`),
        "\nğŸ”¹ å¤–éƒ¨é€šä¿¡å‘¼ã³å‡ºã—:",
        ...result.network.map(n => ` - ${n}`),
        "\nğŸ”¹ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã£ã½ã„ä»£å…¥:",
        ...result.globals.map(g => ` - ${g}`),
      ].join('\n');

      document.getElementById('output').textContent = out;
    }
  </script>
</body>
</html>

